---
title: 分布式Git
comments: true
published: true
lang: zh-CN
date: 2024-11-18 14:24:54
updated:
tags:
- 版本控制
- Git
categories:
- [工具/IDE, 版本控制, Git]
---

# 分布式Git

> 参考资料：
>
> [Pro Git](https://git-scm.com/book/en/v2)
>
> [GitHub Docs](https://docs.github.com/en)

## 目录

- [分布式Git](#分布式git)
  - [目录](#目录)
  - [分布式工作流程](#分布式工作流程)
    - [集中式工作流程](#集中式工作流程)
    - [集成管理者工作流](#集成管理者工作流)
    - [主管与副主管工作流](#主管与副主管工作流)
  - [向一个项目贡献](#向一个项目贡献)
    - [提交准则](#提交准则)
    - [私有小型团队](#私有小型团队)
    - [私有管理团队](#私有管理团队)
    - [派生的公开项目](#派生的公开项目)
    - [通过邮件的公开项目](#通过邮件的公开项目)
  - [维护项目](#维护项目)
    - [代码管理](#代码管理)
    - [社区支持](#社区支持)
    - [项目规划](#项目规划)
    - [技术改进和优化](#技术改进和优化)
    - [管理贡献者和项目模块](#管理贡献者和项目模块)
    - [社区建设](#社区建设)

## 分布式工作流程

分布式 Git 支持多种工作流程，以满足不同团队和协作模式的需求

### 集中式工作流程

集中式工作流程类似传统的集中式版本控制（如 SVN）。整个团队围绕一个中心远程仓库进行协作。开发者在克隆代码后，如果两人同时进行修改，第一个开发者能顺利推送，而第二个必须先合并更新。

![集中式工作流](https://git-scm.com/book/zh/v2/images/centralized_workflow.png)

### 集成管理者工作流

- **贡献者流程**: 贡献者 fork 主仓库，开发新功能或修复 Bug，推送修改并发起合并请求（PR）。
- **集成管理者流程**: 审核和测试 PR，然后合并到主仓库。

![集成管理者工作流](https://git-scm.com/book/zh/v2/images/integration-manager.png)

### 主管与副主管工作流

适用于大型跨团队项目，设有“主管”和多个“副主管”，各自负责不同模块。流程包括开发者提交代码至副主管，副主管整合并将代码递交给主管审核，最终合并至主分支。这种工作流结构类似于金字塔式管理

方式一：

1. 开发人员向副主管提交代码
   开发人员对某个模块或功能进行开发，并向该模块的副主管提交代码。通常，通过创建功能分支并发起合并请求来完成此步骤。副主管负责代码的初步审查和测试。
2. 副主管合并代码
   副主管在自己的分支中管理合并，确保子模块的代码质量。经过必要的测试和改进后，副主管会将合并后的代码推送到上级分支（例如 `develop`）。
3. 主管审查代码
   主管负责整个项目的主分支，所有来自副主管的合并最终需要由主管进行最终审核和测试。主管在确认代码质量后，才会合并到 `main` 分支。

方式二：

1. 普通开发者在自己的主题分支上工作，并根据 `master` 分支进行变基。 这里是主管推送的参考仓库的 `master` 分支。
2. 副主管将普通开发者的主题分支合并到自己的 `master` 分支中。
3. 主管将所有副主管的 `master` 分支并入自己的 `master` 分支中。
4. 最后，主管将集成后的 `master` 分支推送到参考仓库中，以便所有其他开发者以此为基础进行变基。

![主管与副主管工作流](https://git-scm.com/book/zh/v2/images/benevolent-dictator.png)

## 向一个项目贡献

### 提交准则

- 遵循代码规范和风格，提供清晰的提交信息。

- 推荐的约定式提交格式为：

   [约定式提交](https://www.conventionalcommits.org/zh-hans/v1.0.0/)规范是一种基于提交信息的轻量级约定。 它提供了一组简单规则来创建清晰的提交历史； 这更有利于编写自动化工具。 通过在提交信息中描述功能、修复和破坏性变更， 使这种惯例与 [SemVer](http://semver.org/lang/zh-CN) 相互对应。

   提交说明的结构如下所示：

   ------

   原文：

   ```
   <type>[optional scope]: <description>
   
   [optional body]
   
   [optional footer(s)]
   ```

   ------

   提交说明包含了下面的结构化元素，以向类库使用者表明其意图：

   1. **fix:** *类型* 为 `fix` 的提交表示在代码库中修复了一个 bug（这和语义化版本中的 [`PATCH`](https://semver.org/lang/zh-CN/#摘要) 相对应）。
   2. **feat:** *类型* 为 `feat` 的提交表示在代码库中新增了一个功能（这和语义化版本中的 [`MINOR`](https://semver.org/lang/zh-CN/#摘要) 相对应）。
   3. **BREAKING CHANGE:** 在脚注中包含 `BREAKING CHANGE:` 或 <类型>(范围) 后面有一个 `!` 的提交，表示引入了破坏性 API 变更（这和语义化版本中的 [`MAJOR`](https://semver.org/lang/zh-CN/#摘要) 相对应）。 破坏性变更可以是任意 *类型* 提交的一部分。
   4. 除`fix:`和`feat:`之外，也可以使用其它提交类型，例如@commitlint/config-conventional（基于Angular 约定）中推荐的`build:`、`chore:`、`ci:`、`docs:`、`style:`、`refactor:`、`perf:`、`test:`，等等。
      - build: 用于修改项目构建系统，例如修改依赖库、外部接口或者升级 Node 版本等；
      - chore: 用于对非业务性代码进行修改，例如修改构建流程或者工具配置等；
      - ci: 用于修改持续集成流程，例如修改 Travis、Jenkins 等工作流配置；
      - docs: 用于修改文档，例如修改 README 文件、API 文档等；
      - style: 用于修改代码的样式，例如调整缩进、空格、空行等；
      - refactor: 用于重构代码，例如修改代码结构、变量名、函数名等但不修改功能逻辑；
      - perf: 用于优化性能，例如提升代码的性能、减少内存占用等；
      - test: 用于修改测试用例，例如添加、删除、修改代码的测试用例等。
   5. 脚注中除了 `BREAKING CHANGE: <description>` ，其它条目应该采用类似 [git trailer format](https://git-scm.com/docs/git-interpret-trailers) 这样的惯例。

   其它提交类型在约定式提交规范中并没有强制限制，并且在语义化版本中没有隐式影响（除非它们包含 BREAKING CHANGE）。 可以为提交类型添加一个围在圆括号内的范围，以为其提供额外的上下文信息。例如 `feat(parser): adds ability to parse arrays.`。

- 编写测试代码

- 创建分支和合并请求

  开发者应在独立分支工作，完成后通过合并请求进行代码审查。

### 私有小型团队

在私有小型团队中，成员之间的沟通通常更加紧密和直接，贡献流程也可能更加简化。典型的流程如下：

- 在本地仓库进行开发，定期同步主分支。
- 发起代码审查流程。

### 私有管理团队

私有管理团队通常适用于较大的公司或团队，可能有更严格的流程和分层管理。主要贡献步骤如下：

- **开发人员分支提交**
  开发人员在独立分支进行工作，修改完成后发起合并请求至主开发分支（如 `develop`）。团队会有特定的审核者对代码进行审查和合并。
- **管理员审查和合并**
  管理团队通常由经验丰富的开发者组成，他们负责最终代码的合并决策。任何重要的修改都需要经过管理员的批准。
- **功能和安全检查**
  在合并之前，可能会有专门的测试人员或工具进行功能测试和安全检查，确保代码达到项目的质量标准。

### 派生的公开项目

开源项目通常使用派生（Fork）和合并请求（Pull Request）的模式，这在 GitHub 等平台上非常常见：

- **Fork 项目仓库**
  开发者先在自己的账户中创建项目的副本。
- **在本地开发**
  克隆 Fork 的仓库并在独立分支中进行修改。
- **提交修改并创建合并请求**
  修改完成后，将分支推送到 Fork 的远程仓库，并向原始仓库提交合并请求。通常，项目维护者会审核代码并提供反馈。
- **响应反馈**
  根据项目维护者的反馈进行修改和重新提交，直至获得合并。

### 通过邮件的公开项目

在某些项目中，贡献可能通过邮件进行。使用 `git format-patch` 生成补丁并发送给维护者。

```bash
# 会根据指定的分支生成一个或多个 .patch 文件，包含所有尚未合并的提交
git format-patch origin/main
```

## 维护项目

项目维护包括代码管理、社区支持、项目规划等，确保项目持续发展和社区活跃：

### 代码管理

在维护一个项目并进行版本发布时，您需要进行一系列的操作来确保发布过程顺利进行，包括打标签、生成构建号、准备发布归档、制作提交简报等

- **审核和合并代码**
  维护者负责审查来自贡献者的 Pull Request，确保代码符合项目的质量标准、风格规范和功能需求。合并前需要确认代码不会引入新的 Bug，并尽量避免对现有功能的破坏。
- **管理分支**
  维护者需要管理项目的分支策略，确保开发分支、主分支、特性分支等之间的合并流程规范。通常情况下，主分支用于发布稳定版本，开发分支用于集成新的功能和修复。
- **发布新版本**
  维护者需要规划和管理版本发布的节奏，包括修复 Bug、添加新功能、优化性能等。通常伴随版本发布，维护者需要打标签并生成变更日志。

### 社区支持

- **处理问题（Issues）**
  维护者需要跟踪项目中的问题和建议（通常通过 GitHub 或 GitLab 的 Issues 系统）。快速响应和处理 Issue 有助于增强社区的活跃度和信任感。
- **回复和指导贡献者**
  维护者是项目的核心支持者，对社区贡献者进行指导和帮助可以激励更多人参与项目。无论是初学者还是高级开发者的贡献，都应得到认可和合理的反馈。
- **保持良好的沟通**
  维护者需要确保与项目贡献者和使用者之间的沟通畅通。例如，可以通过讨论板、电子邮件或即时聊天工具（如 Slack 或 Discord）来解决问题或获取反馈。

### 项目规划

- **制定项目路线图**
  维护者需要规划项目的中长期发展方向。明确短期和长期目标，制定路线图并与社区分享，让开发人员和用户了解项目的发展规划。
- **整理和维护文档**
  高质量的文档有助于新用户快速上手项目，也能降低社区的维护成本。文档应该包括：安装指南、使用手册、API 参考、贡献指南等。
- **设定贡献指南和标准**
  提供明确的贡献指南，让贡献者知道如何提交代码、格式要求、测试需求等，能极大提高协作效率。通常可以在项目的 `CONTRIBUTING.md` 文件中说明这些信息。

### 技术改进和优化

- **优化性能**
  持续优化项目的性能，关注运行效率和资源消耗，让项目在不同环境中保持高效稳定。
- **修复 Bug**
  维护者需要快速响应和修复已知 Bug，特别是那些影响用户体验的严重问题。每次修复应尽量增加测试用例，避免问题再次发生。
- **引入自动化工具**
  使用自动化测试、CI/CD（持续集成和交付）工具来验证代码变更、运行测试、部署新版本等，可以大大减轻维护者的工作负担，提升开发效率和稳定性。

### 管理贡献者和项目模块

- **分配任务和权限**
  在大型项目中，可能会有多个维护者协同管理不同的模块。维护者可以分配任务或权限给其他经验丰富的贡献者，形成“模块主管”或“副维护者”角色，减少单一管理者的工作负担。
- **组织定期会议或讨论**
  在开源社区或大型团队项目中，可以定期组织会议，讨论项目当前的状态、面临的问题和未来计划，保持项目的活力和方向性。

### 社区建设

- **激励和表彰贡献者**
  认可并奖励那些对项目做出重大贡献的成员。无论是通过“贡献者榜单”，还是简单的公开感谢，都有助于促进更多贡献者参与。
- **积极推广项目**
  通过博客、演讲、社交媒体等途径推广项目，吸引更多人了解和参与。这有助于扩大项目的影响力和用户基础。

项目维护是一项复杂的任务，既需要技术能力也需要管理和沟通技巧。优秀的维护者不仅关注项目代码的稳定性和发展，还注重社区建设和贡献者的支持，确保项目能够在技术和社区两方面得到平衡发展。
